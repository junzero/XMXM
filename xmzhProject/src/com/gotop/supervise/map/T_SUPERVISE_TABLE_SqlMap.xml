<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="T_SUPERVISE_TABLE_SqlMap" >
  <typeAlias alias="supervise" type="com.gotop.supervise.model.TSuperviseTable"/>
  <select id="query_supervise_info" resultClass="supervise" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--通过主键查询一条数据-->
    select SUPERVISE_ID as superviseId, FLOW_ID flowId, SUPERVISE_ITEM superviseItem, CONTENT, IMP_UNIT impUnit, CO_UNIT coUnit, COMPLETE_DATE completeDate,
      CREATEOR createor, CREATE_DATE createDate, LINKER_PHONE linkerPhone, ORGID orgid,CO_UNITNAME as conUnitName ,IMP_UNITNAME as impUnitName,IMP_ORGID impOrgid,CO_ORGID coOrgid,
    REMIND_ID as remindId
    from T_SUPERVISE_TABLE
    where (SUPERVISE_ID = #superviseId:DECIMAL# or FLOW_ID=#flowId:VARCHAR#)
  </select>
  
  <select id="query_supervise_info1" resultClass="supervise" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--通过主键查询一条数据-->
    select SUPERVISE_ID as superviseId, FLOW_ID flowId, SUPERVISE_ITEM superviseItem, CONTENT, IMP_UNIT impUnit, CO_UNIT coUnit, COMPLETE_DATE completeDate,
      CREATEOR createor, CREATE_DATE createDate, LINKER_PHONE linkerPhone, ORGID orgid,CO_UNITNAME as conUnitName ,IMP_UNITNAME as impUnitName,IMP_ORGID impOrgid,CO_ORGID coOrgid
    from T_SUPERVISE_TABLE
    where SUPERVISE_ID = #superviseId:DECIMAL# 
  </select>

  <select id="query_supervise_infos" resultClass="supervise" parameterClass="supervise" >
    <!--根据Bean数据模板查询条件查询所有记录，可查询分页数据-->
    select a.SUPERVISE_ID as superviseId, a.FLOW_ID as flowId, a.SUPERVISE_ITEM as superviseItem, a.CONTENT as content, a.IMP_UNIT as impUnit, a.CO_UNIT as coUnit, a.COMPLETE_DATE as completeDate,
      a.CREATEOR as createor, a.CREATE_DATE as createDate, a.LINKER_PHONE as linkerPhone, a.ORGID as orgid,a.IMP_ORGID impOrgid,a.CO_ORGID coOrgid,IMP_UNITNAME as impUnitName ,CO_UNITNAME as conUnitName,
      decode(b.status,'', '未阅','0','未阅','已阅') as statusName,b.rec_id as recId,b.status 
    from T_SUPERVISE_TABLE a,t_supervice_receive b where a.SUPERVISE_ID=b.SUPERVISE_ID
    and b.receive_emp='$empid$'
      <isNotNull prepend="" property="superviseId" >
        <isNotEmpty prepend="and" property="superviseId">
        a.SUPERVISE_ID = #superviseId:DECIMAL#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="flowId" >
        <isNotEmpty prepend="and" property="flowId">
        a.FLOW_ID = #flowId:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="superviseItem" >
       <isNotEmpty prepend="and" property="superviseItem">
        a.SUPERVISE_ITEM like '%$superviseItem$%'
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="content" >
      <isNotEmpty prepend="and" property="content">
        a.CONTENT = #content:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="impUnit" >
       <isNotEmpty prepend="and" property="impUnit">
        a.IMP_UNIT = #impUnit:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="coUnit" >
       <isNotEmpty prepend="and" property="coUnit">
        a.CO_UNIT = #coUnit:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="completeDate" >
       <isNotEmpty prepend="and" property="completeDate">
        a.COMPLETE_DATE = #completeDate:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="createor" >
       <isNotEmpty prepend="and" property="createor">
        a.CREATEOR = #createor:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="createDate" >
      <isNotEmpty prepend="and" property="createDate">
       <![CDATA[
        a.CREATE_DATE >= #createDate:VARCHAR#
        ]]>
        </isNotEmpty>
      </isNotNull>
       <isNotNull prepend="" property="createDate1" >
        <isNotEmpty prepend="and" property="createDate1">
       <![CDATA[
        a.CREATE_DATE <= #createDate1:VARCHAR#
        ]]>
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="linkerPhone" >
      <isNotEmpty prepend="and" property="linkerPhone">
        a.LINKER_PHONE = #linkerPhone:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      <isNotNull prepend="" property="orgid" >
       <isNotEmpty prepend="and" property="orgid">
        a.ORGID = #orgid:VARCHAR#
        </isNotEmpty>
      </isNotNull>
      order by a.CREATE_DATE desc

  </select>
  
  <delete id="delete_supervise_info" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on .
    -->
    <!--通过主键删除一条记录-->
    delete from T_SUPERVISE_TABLE
    where SUPERVISE_ID = #superviseId:DECIMAL#
  </delete>
  
  <delete id="delete_supervise_info2" parameterClass="supervise" >
    <!--根据Bean数据模板查询条件删除记录-->
    delete from T_SUPERVISE_TABLE
    <dynamic prepend="where" >
      <isNotEmpty prepend="and" property="superviseId" >
        SUPERVISE_ID = #superviseId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="flowId" >
        FLOW_ID = #flowId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="superviseItem" >
        SUPERVISE_ITEM = #superviseItem:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="content" >
        CONTENT = #content:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="impUnit" >
        IMP_UNIT = #impUnit:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="coUnit" >
        CO_UNIT = #coUnit:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="completeDate" >
        COMPLETE_DATE = #completeDate:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="createor" >
        CREATEOR = #createor:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="createDate" >
        CREATE_DATE = #createDate:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="linkerPhone" >
        LINKER_PHONE = #linkerPhone:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="orgid" >
        ORGID = #orgid:VARCHAR#
      </isNotEmpty>
    </dynamic>
  </delete>
  <insert id="insert_supervise_info" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--通过主键更新整条数据-->
     <selectKey resultClass="java.lang.Long" keyProperty="superviseId" >
      select T_SUPERVISE_TABLE_SEQ.nextval from dual
    </selectKey>
    insert into T_SUPERVISE_TABLE (SUPERVISE_ID, FLOW_ID, SUPERVISE_ITEM, CONTENT, IMP_UNIT,
      CO_UNIT, COMPLETE_DATE, CREATEOR, CREATE_DATE, LINKER_PHONE, ORGID,create_time,IMP_UNITNAME,CO_UNITNAME,IMP_ORGID ,CO_ORGID,REMIND_ID)
    values (#superviseId:DECIMAL:-9999#, #flowId:VARCHAR#, #superviseItem:VARCHAR#,
      #content:VARCHAR#, #impUnit:VARCHAR#, #coUnit:VARCHAR#, #completeDate:VARCHAR#,
      #createor:VARCHAR#, #createDate:VARCHAR#, #linkerPhone:VARCHAR#, #orgid:VARCHAR#,#createTime:varchar#,
      #impUnitName:varchar#,#conUnitName:varchar#,#impOrgid:varchar#,#coOrgid:varchar#,#remindId:varchar#)
  </insert>
  <update id="update_supervise_info" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--通过主键更新一条全部字段内容-->
    update T_SUPERVISE_TABLE
    set
      SUPERVISE_ITEM = #superviseItem:VARCHAR#,
      CONTENT = #content:VARCHAR#,
      IMP_UNIT = #impUnit:VARCHAR#,
      CO_UNIT = #coUnit:VARCHAR#,
      COMPLETE_DATE = #completeDate:VARCHAR#,
      LINKER_PHONE = #linkerPhone:VARCHAR#,
      CO_UNITNAME = #conUnitName:varchar# ,
      IMP_UNITNAME=#impUnitName:varchar#,
      IMP_ORGID =#impOrgid:varchar#,
      CO_ORGID=#coOrgid:varchar#,
      REMIND_ID = #remindId:varchar#
    where SUPERVISE_ID = #superviseId:DECIMAL#
  </update>
  <update id="update_supervise_receive_status" parameterClass="com.gotop.supervise.model.TSuperviseTable" >
    <!--通过主键更新一条全部字段内容-->
     update T_SUPERVICE_RECEIVE
    set 
      STATUS = '1',
      RECEIVE_DATE = to_char(sysdate,'yyyyMMdd'),
      RECEIVE_TIME = to_char(sysdate,'HHmmss')
    where REC_ID = #recId:DECIMAL#
  </update>
  
  
   <!-- 获取各部室下（副负责人）a.positionid=？ 待定 -->
   <select id="queryBushiPerson" resultClass="com.gotop.supervise.model.TSuperviseTable" parameterClass="java.util.HashMap" >
  	 select distinct a.empid,b.empname from om_empposition a,om_employee b ,om_emporg c where   a.empid = b.empid and a.empid=c.empid and c.ismain='y' and a.positionid!=#positionid#  and c.orgid=#orgid#  and c.empid!=#empid# 
  </select>
  
   
   <!-- 获取当前人员所在部门的主要负责人 -->
 <select id="queryBushiImpPs" resultClass="com.gotop.supervise.model.TSuperviseTable" parameterClass="java.util.HashMap" >
     SELECT e.empid as empid,e.empname
  FROM OM_EMPLOYEE    E,
       OM_EMPPOSITION N,
       OM_POSITION    OM,
       OM_EMPORG      ORG,
       OM_EMPORG      G
 WHERE E.EMPID = N.EMPID
   AND OM.POSITIONID = N.POSITIONID
   AND ORG.ORGID = G.ORGID
   AND OM.POSICODE = 'BMFZR'
   AND G.EMPID = #empid#
   AND ORG.EMPID = E.EMPID 
 <!--   select a.task_assignee_id as empid ,b.empname from T_PROCESS_TASK_ASSIGNEE_PERSON a , om_employee b where a.task_assignee_id=b.empid and id=#parentId#  --> 
 </select>
 
    <select id="queryLeader" resultClass="com.gotop.supervise.model.TSuperviseTable" parameterClass="java.util.HashMap" >
  	 select b.empid,b.empname 
     from om_empposition a,
     om_employee b,
     om_position c
     where a.positionid=c.positionid
     and b.empid = a.empid
     and c.posicode=#positionCode#
  </select>
</sqlMap>