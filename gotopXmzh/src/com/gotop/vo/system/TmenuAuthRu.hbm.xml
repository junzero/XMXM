<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
    Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
    <class name="com.gotop.vo.system.TmenuAuthRu" table="tMenuAuthRU">
        <composite-id name="id" class="com.gotop.vo.system.TmenuAuthRuId">
            <key-property name="id" type="java.lang.Integer">
                <column name="ID" />
            </key-property>
            <key-property name="sqdxlx" type="java.lang.Short">
                <column name="SQDXLX" />
            </key-property>
            <key-property name="cdid" type="java.lang.String">
                <column name="CDID" length="40" />
            </key-property>
        </composite-id>
        <property name="sqr" type="java.lang.Integer">
            <column name="SQR" />
        </property>
        <property name="sqsj" type="java.util.Date">
            <column name="SQSJ" length="23" />
        </property>
    </class>
<!-- 获取用户权限范围内的大类菜单 ID,USID-->
<sql-query name="menuauthru.getPermitMenuGroup">
<return alias="menugroup" class="com.gotop.vo.util.TmenuGroup"/> 
select {menugroup}.FZBH as {menugroup.fzbh},{menugroup}.FZMC as {menugroup.fzmc},
       {menugroup}.FZSM as {menugroup.fzsm},{menugroup}.XSWZ as {menugroup.xswz},
       {menugroup}.TP2L as {menugroup.tp2l} 
from tMenuGroup {menugroup} 
where FZBH in 
 	(select distinct(FZBH) from tMenu a,tMenuAuthRU b 
 	 where a.CDID=b.CDID and 
 	      ((b.ID=? and b.SQDXLX=0) or (b.ID in (select RID from tRole2User where USID=?) and b.SQDXLX=1))) 	
order by XSWZ
</sql-query>    
<!--获取用户权限范围内某一大类菜单下的小类菜单 ID,SQDXLX,FZBH-->
<sql-query name="menuauthru.getPermitSubMenus">
<return alias="menu" class="com.gotop.vo.util.Tmenu"/>   
select {menu}.CDID as {menu.cdid},{menu}.PTDM as {menu.ptdm},{menu}.MKDM as {menu.mkdm},
{menu}.CDMC as {menu.cdmc},{menu}.XSXH as {menu.xsxh},{menu}.WZBH as {menu.wzbh},
{menu}.FCDID as {menu.fcdid},{menu}.CDJB as {menu.cdjb},{menu}.FZBH as {menu.fzbh},
{menu}.JLBM as {menu.jlbm},{menu}.URL as {menu.url},{menu}.HASCHILD as {menu.haschild}
from  (select distinct a.* from tMenu a,tMenuAuthRU b 
	where a.CDID=b.CDID and a.FZBH=? and  a.CDJB = ? and
		((b.ID=? and b.SQDXLX=0) or 
		(((b.ID in (select RID from tRole2User where USID=?)) and b.SQDXLX=1)))) {menu} 
order by {menu}.CDID,{menu}.XSXH
</sql-query> 

<!--获取用户权限范围内某一大类菜单下的小类菜单 ID,SQDXLX,FZBH-->
<sql-query name="menuauthru.getPermitSubMenusBycd">
<return alias="menu" class="com.gotop.vo.util.Tmenu"/>   
select {menu}.CDID as {menu.cdid},{menu}.PTDM as {menu.ptdm},{menu}.MKDM as {menu.mkdm},
{menu}.CDMC as {menu.cdmc},{menu}.XSXH as {menu.xsxh},{menu}.WZBH as {menu.wzbh},
{menu}.FCDID as {menu.fcdid},{menu}.CDJB as {menu.cdjb},{menu}.FZBH as {menu.fzbh},
{menu}.JLBM as {menu.jlbm},{menu}.URL as {menu.url},{menu}.HASCHILD as {menu.haschild}
from  (select distinct a.* from tMenu a,tMenuAuthRU b 
	where a.CDID=b.CDID and a.FCDID=? and  a.CDJB = ? and
		((b.ID=? and b.SQDXLX=0) or 
		(((b.ID in (select RID from tRole2User where USID=?)) and b.SQDXLX=1)))) {menu} 
order by {menu}.CDID,{menu}.XSXH
</sql-query> 
<!--获取用户权限范围内某的常用菜单 ID,SQDXLX,FZBH-->
<sql-query name="menuauthru.getPermitCommonMenus">
<return alias="menu" class="com.gotop.vo.util.Tmenu" />   
select {menu}.CDID as {menu.cdid},{menu}.PTDM as {menu.ptdm},{menu}.MKDM as {menu.mkdm},
{menu}.CDMC as {menu.cdmc},{menu}.USENUM as {menu.xsxh},{menu}.WZBH as {menu.wzbh},
{menu}.FCDID as {menu.fcdid},{menu}.CDJB as {menu.cdjb},{menu}.FZBH as {menu.fzbh},
{menu}.JLBM as {menu.jlbm},{menu}.URL as {menu.url},{menu}.HASCHILD as {menu.haschild}
from  (select distinct a.*,c.usenum from tMenu a,tMenuAuthRU b,tCommon c 
	where a.CDID=b.CDID and a.mkdm=c.mkdm and
		((b.ID=? and b.SQDXLX=0) or 
		(((b.ID in (select RID from tRole2User where USID=?)) and b.SQDXLX=1)))) {menu} 
order by {menu}.XSXH
</sql-query> 
<!--按用户ID或是角色的权限,获取权限范围内全部小类菜单 ID,SQDXLX-->
<sql-query name="menuauthru.getPermitMenus">
<return alias="menu" class="com.gotop.vo.util.Tmenu"/>   
select {menu}.CDID as {menu.cdid},{menu}.PTDM as {menu.ptdm},{menu}.MKDM as {menu.mkdm},
{menu}.CDMC as {menu.cdmc},{menu}.XSXH as {menu.xsxh},{menu}.WZBH as {menu.wzbh},
{menu}.FCDID as {menu.fcdid},{menu}.CDJB as {menu.cdjb},{menu}.FZBH as {menu.fzbh},
{menu}.JLBM as {menu.jlbm},{menu}.URL as {menu.url}
from  (select distinct a.* from tMenu a,tMenuAuthRU b 
	where a.CDID=b.CDID and 
	((b.ID=? and b.SQDXLX=?) or 
		((?=0) and ((b.ID in (select RID from tRole2User where USID=?)) and b.SQDXLX=1)))) {menu} 
order by {menu}.CDID,{menu}.XSXH
</sql-query>    
<!--按用户ID或是角色的权限,获取某一菜单的权限 ID,SQDXLX-->
<sql-query name="menuauthru.judgePermitMenu">
<return alias="menu" class="com.gotop.vo.util.Tmenu"/>   
select {menu}.CDID as {menu.cdid},{menu}.PTDM as {menu.ptdm},{menu}.MKDM as {menu.mkdm},
{menu}.CDMC as {menu.cdmc},{menu}.XSXH as {menu.xsxh},{menu}.WZBH as {menu.wzbh},
{menu}.FCDID as {menu.fcdid},{menu}.CDJB as {menu.cdjb},{menu}.FZBH as {menu.fzbh},
{menu}.JLBM as {menu.jlbm},{menu}.URL as {menu.url}
from  (select distinct a.* from tMenu a,tMenuAuthRU b 
	where a.CDID=b.CDID and a.MKDM=? and
	((b.ID=? and b.SQDXLX=?) or 
		((?=0) and ((b.ID in (select RID from tRole2User where USID=?)) and b.SQDXLX=1)))) {menu} 
order by {menu}.XSXH,{menu}.CDID
</sql-query>
</hibernate-mapping>
